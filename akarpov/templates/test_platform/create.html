{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Creating new Form on akarpov{% endblock %}

{% block content %}
<form class="pt-2 needs-validation" enctype="multipart/form-data" method="POST" id="designer-form">
    {% csrf_token %}
    {{ form.media }}
    {% for field in form %}
        {{ field|as_crispy_field }}
    {% endfor %}
</form>
<div class="row d-flex justify-content-center">
  <div class="m-3 col-md-2 col-sm-auto" id="questions">
      <div id="new_btn" class="input-group mb-3">
        <button type="button" id="create_question_button" class="btn btn-outline-primary"><i class="bi bi-plus-circle"></i></button>
        <select class="form-select" id="inputGroupSelect" aria-label="select with addon">
        </select>
      </div>
  </div>
</div>
<div class="mt-4 flex justify-end space-x-4">
    <input class="btn btn-success" type="submit" form="designer-form" value="Create"/>
</div>
{% endblock %}

{% block inline_javascript %}
<script>
let questionTypes = []
let questionTypesDescription = []
let questions = []
let q_index = 1;

const button = document.getElementById("create_question_button");
const form = document.getElementById("designer-form");
const select = document.getElementById('inputGroupSelect')

{% for question, question_form in questions.items %}
  type = '{{ question.type }}'
  description = '{{ question.type_plural }}'

  questionTypes.push(type)
  questionTypesDescription.push(description)
  select.innerHTML += `<option value="${type}">${description}</option>`

  questionPrototype = `
  <div class="border p-4 mt-5 rounded-2">
  <input type="hidden" value="${type}" name="type" />
  {% for field in question_form %}
      {{ field|as_crispy_field }}
  {% endfor %}
  </div>
  `
  questions.push(questionPrototype)
{% endfor %}

button.onclick = function () {
    console.log(q_index)
    let index = select.selectedIndex;
    let div = questions[index];
    form.innerHTML += div;
    q_index += 1;
}
</script>
{% endblock %}
