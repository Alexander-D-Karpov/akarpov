{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block javascript %}
  <script src="{% static 'js/jquery.min.js' %}"></script>
{% endblock %}

{% block content %}
<form method="post" action="{% url 'gallery:upload' %}" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.management_form }}
      {% for field in form %}
        {{ field | as_crispy_field }}
      {% endfor %}
    <button type="submit">Upload</button>
</form>

<div id="progress-bar" style="width:0; height:20px; background:green;"></div>
<script>
const form = document.querySelector('form');
form.addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(form);
    const xhr = new XMLHttpRequest();
    xhr.open('POST', form.action, true);
    xhr.upload.onprogress = function(e) {
        if (e.lengthComputable) {
            const percentage = (e.loaded / e.total) * 100;
            document.getElementById('progress-bar').style.width = percentage + '%';
        }
    };
    xhr.onload = function() {
        if (this.status === 200) {
            console.log('Upload complete!');
        } else {
            console.error('Upload failed:', this.responseText);
        }
    };
    xhr.send(formData);
});
</script>
{% endblock %}
